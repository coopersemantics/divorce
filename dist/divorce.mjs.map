{"version":3,"file":"divorce.mjs","sources":["../node_modules/next-tick/index.js","../lib/utils.js","../lib/symbols.js","../lib/status.js","../lib/resolution.js","../lib/divorce.js"],"sourcesContent":["'use strict';\n\nvar callable, byObserver;\n\ncallable = function (fn) {\n\tif (typeof fn !== 'function') throw new TypeError(fn + \" is not a function\");\n\treturn fn;\n};\n\nbyObserver = function (Observer) {\n\tvar node = document.createTextNode(''), queue, currentQueue, i = 0;\n\tnew Observer(function () {\n\t\tvar callback;\n\t\tif (!queue) {\n\t\t\tif (!currentQueue) return;\n\t\t\tqueue = currentQueue;\n\t\t} else if (currentQueue) {\n\t\t\tqueue = currentQueue.concat(queue);\n\t\t}\n\t\tcurrentQueue = queue;\n\t\tqueue = null;\n\t\tif (typeof currentQueue === 'function') {\n\t\t\tcallback = currentQueue;\n\t\t\tcurrentQueue = null;\n\t\t\tcallback();\n\t\t\treturn;\n\t\t}\n\t\tnode.data = (i = ++i % 2); // Invoke other batch, to handle leftover callbacks in case of crash\n\t\twhile (currentQueue) {\n\t\t\tcallback = currentQueue.shift();\n\t\t\tif (!currentQueue.length) currentQueue = null;\n\t\t\tcallback();\n\t\t}\n\t}).observe(node, { characterData: true });\n\treturn function (fn) {\n\t\tcallable(fn);\n\t\tif (queue) {\n\t\t\tif (typeof queue === 'function') queue = [queue, fn];\n\t\t\telse queue.push(fn);\n\t\t\treturn;\n\t\t}\n\t\tqueue = fn;\n\t\tnode.data = (i = ++i % 2);\n\t};\n};\n\nmodule.exports = (function () {\n\t// Node.js\n\tif ((typeof process === 'object') && process && (typeof process.nextTick === 'function')) {\n\t\treturn process.nextTick;\n\t}\n\n\t// MutationObserver\n\tif ((typeof document === 'object') && document) {\n\t\tif (typeof MutationObserver === 'function') return byObserver(MutationObserver);\n\t\tif (typeof WebKitMutationObserver === 'function') return byObserver(WebKitMutationObserver);\n\t}\n\n\t// W3C Draft\n\t// http://dvcs.w3.org/hg/webperf/raw-file/tip/specs/setImmediate/Overview.html\n\tif (typeof setImmediate === 'function') {\n\t\treturn function (cb) { setImmediate(callable(cb)); };\n\t}\n\n\t// Wide available standard\n\tif ((typeof setTimeout === 'function') || (typeof setTimeout === 'object')) {\n\t\treturn function (cb) { setTimeout(callable(cb), 0); };\n\t}\n\n\treturn null;\n}());\n","export const isObject = value =>\n  Object.prototype.toString.call(value) === '[object Object]';\n\nexport const isFunction = value =>\n  Object.prototype.toString.call(value) === '[object Function]';\n","export const promiseStatus = Symbol('[[promiseStatus]]');\nexport const promiseValue = Symbol('[[promiseValue]]');\nexport const promiseQueue = Symbol('[[promiseQueue]]');\n","export const RESOLVED = 'resolved';\nexport const REJECTED = 'rejected';\nexport const PENDING = 'pending';\n","import { isObject, isFunction } from './utils';\nimport { promiseStatus, promiseValue, promiseQueue } from './symbols';\nimport { PENDING, RESOLVED, REJECTED } from './status';\n\n/**\n * @method\n * @param {Object} promise\n * @param {*} value\n */\nexport const resolvePromise = (promise, value) => {\n  if (promise[promiseStatus] !== PENDING) {\n    return;\n  }\n\n  promise[promiseValue] = value;\n  promise[promiseStatus] = RESOLVED;\n  promise[promiseQueue].forEach(({ onFulfilled }) => onFulfilled());\n};\n\n/**\n * @method\n * @param {Object} promise\n * @param {*} reason\n */\nexport const rejectPromise = (promise, reason) => {\n  if (promise[promiseStatus] !== PENDING) {\n    return;\n  }\n\n  promise[promiseValue] = reason;\n  promise[promiseStatus] = REJECTED;\n  promise[promiseQueue].forEach(({ onRejected }) => onRejected());\n};\n\n/**\n * @method\n * @description The promise resolution procedure is an abstract operation taking as input a promise\n * and a value. If value is a thenable, it attempts to make promise adopt the state of value, under the\n * assumption that value behaves at least somewhat like a promise. Otherwise, it fulfills promise with the value.\n * @param {Object} promise\n * @param {*} value\n */\nexport const resolutionProcedure = (promise, value) => {\n  if (promise === value) {\n    return rejectPromise(promise, new TypeError('Chaining cycle detected for promise #<Promise>'));\n  }\n\n  if (value instanceof promise.constructor) {\n    return value.then(\n      (v) => resolvePromise(promise, v),\n      (r) => rejectPromise(promise, r)\n    );\n  }\n\n  if (!(isObject(value) || isFunction(value))) {\n    return resolvePromise(promise, value);\n  }\n\n  let then;\n\n  try {\n    then = value.then;\n  } catch (reason) {\n    rejectPromise(promise, reason);\n  }\n\n  if (!isFunction(then)) {\n    return resolvePromise(promise, value);\n  }\n\n  let isCalled = false;\n\n  try {\n    then.call(\n      value,\n      (v) => {\n        if (!isCalled) {\n          resolutionProcedure(promise, v);\n          isCalled = true;\n        }\n      },\n      (r) => {\n        if (!isCalled) {\n          rejectPromise(promise, r);\n          isCalled = true;\n        }\n      }\n    );\n  } catch (reason) {\n    if (!isCalled) {\n      rejectPromise(promise, reason);\n    }\n  }\n};\n","import nextTick from 'next-tick';\nimport { isFunction } from './utils';\nimport { promiseStatus, promiseValue, promiseQueue } from './symbols';\nimport { RESOLVED, REJECTED, PENDING } from './status';\nimport { resolutionProcedure, rejectPromise } from './resolution';\n\n/**\n * @class Divorce\n */\nexport default class Divorce {\n  /**\n   * @constructor\n   * @description Represents the eventual completion (or failure) of an\n   * asynchronous operation and its resulting value.\n   * @param {Function} resolver\n   */\n  constructor (resolver) {\n    this[promiseStatus] = PENDING;\n    this[promiseValue] = undefined;\n    this[promiseQueue] = [];\n\n    try {\n      resolver(\n        value => resolutionProcedure(this, value),\n        reason => rejectPromise(this, reason)\n      );\n    } catch (reason) {\n      rejectPromise(this, reason);\n    }\n  }\n\n  /**\n   * @method\n   * @description Returns a `Divorce` object that takes two arguments:\n   * callback functions for the success and failure cases of the `Divorce` object.\n   * @param {Function} onFulfilled\n   * @param {Function} [onRejected]\n   * @returns {Object} Divorce\n   */\n  then (onFulfilled, onRejected) {\n    return new Divorce((resolve, reject) => {\n      const onFulfilledHandler = wrapHandler(\n        !isFunction(onFulfilled) ? (value) => value : onFulfilled,\n        this,\n        resolve,\n        reject\n      );\n      const onRejectedHandler = wrapHandler(\n        !isFunction(onRejected) ? (reason) => { throw reason; } : onRejected,\n        this,\n        resolve,\n        reject\n      );\n\n      ({\n        [RESOLVED]: () => onFulfilledHandler(),\n        [REJECTED]: () => onRejectedHandler(),\n        [PENDING]: () =>\n          this[promiseQueue].push({\n            onFulfilled: onFulfilledHandler,\n            onRejected: onRejectedHandler,\n          }),\n      }[this[promiseStatus]]());\n    });\n  }\n\n  /**\n   * @method\n   * @description Returns a `Divorce` object and deals with rejected cases only.\n   * @param {Function} onRejected\n   * @returns {Object} Divorce\n   */\n  catch (onRejected) {\n    return this.then(undefined, onRejected);\n  }\n\n  /**\n   * @property {String}\n   * @description Default string description of the object--accessed internally\n   * by the `Object.prototype.toString()` method.\n   */\n  get [Symbol.toStringTag] () {\n    return 'Promise';\n  }\n\n  /**\n   * @static\n   * @description Returns a `Divorce` object that is resolved with a given value.\n   * @param {*} value\n   * @returns {Object} Divorce\n   */\n  static resolve (value) {\n    return new Divorce(resolve => resolve(value));\n  }\n\n  /**\n   * @static\n   * @description Returns a `Divorce` object that is rejected with a given reason.\n   * @param {*} reason\n   * @returns {Object} Divorce\n   */\n  static reject (reason) {\n    return new Divorce((resolve, reject) => reject(reason));\n  }\n}\n\nconst wrapHandler = (handler, promise, resolve, reject) =>\n  () => {\n    nextTick(() => {\n      try {\n        resolve(handler(promise[promiseValue]));\n      } catch (reason) {\n        reject(reason);\n      }\n    });\n  };\n"],"names":[],"mappings":"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"}